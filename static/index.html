<html>
<head>
    <title> RTMP to WebRTC </title>
</head>

<body>
<h1> RTMP to WebRTC </h1>
<div id="rtmpFeed"></div>
</body>

<script>
    let pc = new RTCPeerConnection({
        iceServers: [
            {
                urls: 'stun:stun.l.google.com:19302'
            }
        ]
    })

    pc.oniceconnectionstatechange = e => console.log(pc.iceConnectionState)
    pc.ontrack = function (event) {
        var el = document.createElement(event.track.kind)
        el.srcObject = event.streams[0]
        el.autoplay = true
        el.controls = true
        el.muted = true

        document.getElementById('rtmpFeed').appendChild(el)
    }

    pc.addTransceiver('video', {'direction': 'recvonly'})
    pc.createOffer()
        .then(offer => {
            pc.setLocalDescription(offer)
            return fetch(`/api/start`, {
                method: 'post',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(offer)
            })
        })
        .then(res => res.json())
        .then(res => pc.setRemoteDescription(new RTCSessionDescription(res)))
        .catch(alert)
</script>
</html>